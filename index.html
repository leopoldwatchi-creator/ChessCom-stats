async function checkStatus(jobId) {
    try {
        const response = await fetch(`/.netlify/functions/check-status?jobId=${jobId}`);
        const data = await response.json();

        if (!response.ok) {
            throw new Error(data.error || "Impossible de vérifier le statut.");
        }

        if (data.status === 'completed') {
            clearInterval(pollingInterval);
            statusElement.textContent = "Analyse terminée ! Voici les résultats :";
            resultsDisplay.textContent = JSON.stringify(data.results, null, 2);
            resultsDisplay.classList.remove('hidden');

        } else if (data.status === 'failed') {
            clearInterval(pollingInterval);
            statusElement.textContent = `L'analyse a échoué. Raison : ${data.results.error}`;

        } else if (data.status === 'running' && data.progress) {
            // --- C'est ici que la magie opère ! ---
            // On affiche la progression si elle existe
            statusElement.textContent = `Analyse en cours... (Mois ${data.progress.current} / ${data.progress.total} traités)`;

        } else {
            // Si le statut est "pending" ou "running" sans info de progression
            statusElement.textContent = `Analyse en cours... (Statut : ${data.status})`;
            console.log(`Statut actuel : ${data.status}`);
        }
    } catch (error) {
        clearInterval(pollingInterval);
        statusElement.textContent = `Erreur lors de la vérification : ${error.message}`;
    }
}
